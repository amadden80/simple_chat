var pusher;
var channel;

function receive_chat(data){
  // console.log(data);
  var chats = $('#chats')
  var new_chat = $('<p>')
  new_chat.text(data)
  new_chat.appendTo(chats)
}

// Loops through all of the subscribed channels and
// unsubscribes from them
function unsubscribe_all(){
  var channels = Object.keys(pusher.channels.channels);
  $.each(channels, function(i, channel){
    pusher.unsubscribe(channel);
  });
  return pusher.channels.channels;
}

$(function(){
  /*
  * Note that we have moved the pusher creation into the application.html page body.
  * For some reason Pusher.key can be read there, but not here...
  * This is a Heroku-specific problem, ideally we'll figure out how to fix it and get our
  * pusher initialization back into a js file.
  */
  pusher.subscribe('chatroom');
  channel = pusher.channels.channels['chatroom'];
  channel.bind( 'message', receive_chat );

})